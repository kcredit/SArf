% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/SArf.R
\name{SArf}
\alias{SArf}
\title{Spatial Autoregressive Random Forest Analysis}
\usage{
SArf(
  formula,
  data,
  coords = NULL,
  k_neighbors = 20,
  n_folds = 5,
  n_bootstrap = 20,
  block_range = 1000,
  num_trees = 500,
  mtry = NULL,
  alpha = 0.05,
  compare_models = c("OLS", "SAR", "SEM", "SAC"),
  include_naive_rf = TRUE,
  naive_test_fraction = 0.2,
  create_map = TRUE,
  seed = 1111,
  verbose = TRUE
)
}
\arguments{
\item{formula}{Model formula (e.g., y ~ x1 + x2)}

\item{data}{Spatial data (sf object or data.frame with spatial information)}

\item{coords}{Optional: matrix of coordinates if data is not sf object}

\item{k_neighbors}{Number of neighbors for spatial weights (default: 20)}

\item{n_folds}{Number of spatial CV folds (default: 5)}

\item{n_bootstrap}{Number of bootstrap iterations per fold (default: 20)}

\item{block_range}{Spatial blocking range in meters (default: 1000)}

\item{num_trees}{Number of trees in random forest (default: 500)}

\item{mtry}{Number of variables to split on at each node (default: NULL, auto-selected)}

\item{alpha}{Significance level for Moran's I test (default: 0.05)}

\item{compare_models}{Vector of models to compare: "OLS", "SAR", "SEM", "SAC" (default: all)}

\item{include_naive_rf}{Logical: include naive RF with simple train-test split? (default: TRUE)}

\item{naive_test_fraction}{Fraction of data for test set in naive RF (default: 0.2)}

\item{create_map}{Logical: create leaflet map of dependent variable? (default: TRUE)}

\item{seed}{Random seed for reproducibility (default: 1111)}

\item{verbose}{Logical: print progress messages? (default: TRUE)}
}
\value{

}
\description{
Comprehensive spatial random forest analysis with proper uncertainty quantification,
comparison to spatial econometric models, and diagnostic outputs.
}
\details{
This function implements a comprehensive spatial autoregressive random forest workflow:

1. **Spatial Diagnostics**: Tests for spatial autocorrelation in the dependent variable
   using Moran's I. Creates a Moran scatter plot showing the relationship between
   values and their spatial lags.

2. **Spatial Cross-Validation**: If Moran's I is significant, performs spatial
   cross-validation with proper within-fold spatial lag calculation to prevent
   data leakage.

3. **Model Comparison**: Compares random forest to traditional spatial econometric
   models (OLS, SAR, SEM, SAC) using RMSE, RÂ², and Moran's I on residuals.

4. **Uncertainty Quantification**: Bootstrap confidence intervals on variable
   importance through spatial CV iterations.

5. **Effect Visualization**: Accumulated Local Effects (ALE) plots with confidence
   ribbons showing marginal effects and uncertainty.

6. **Spatial Visualization**: Interactive leaflet map of the dependent variable.
}
\examples{
\dontrun{
library(sf)
library(SArf)

# Load spatial data
data <- st_read("your_data.shp")

# Run SArf analysis
results <- SArf(
  formula = outcome ~ predictor1 + predictor2 + predictor3,
  data = data,
  k_neighbors = 20,
  n_folds = 5,
  n_bootstrap = 20
)

# View results
print(results)
plot(results)

# Access specific outputs
results$moran_test
results$model_comparison
results$variable_importance
}

}
\references{
Credit, K., Damanpreet, K., and Eccles, E. (2025). Exploring the
transport-health-environment nexus through a new 'Health Rating Index'
for Dublin, Ireland. Proceedings of the 33rd GISRUK Conference.
DOI: 10.5281/zenodo.15183740
}
